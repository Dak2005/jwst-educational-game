<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JWST Educational Game - Explore the Universe</title>
    <meta name="description" content="Interactive educational game about the James Webb Space Telescope featuring 75+ questions, telescope simulations, and space exploration challenges">
    <meta name="keywords" content="JWST, James Webb Space Telescope, space education, astronomy quiz, NASA, space game">
    <meta name="author" content="JWST Educational Game">
    
    <!-- Open Graph / Social Media Preview -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="JWST Educational Game - Explore the Universe">
    <meta property="og:description" content="Interactive educational game about the James Webb Space Telescope with 75+ questions and space challenges">
    <meta property="og:url" content="https://your-username.github.io/jwst-educational-game/">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="JWST Educational Game">
    <meta name="twitter:description" content="Learn about space telescopes and astronomy through interactive gameplay">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='0.9em' font-size='90'%3E🔭%3C/text%3E%3C/svg%3E">
    
    <style>
        /* EMBEDDED CSS - Complete styling optimized for web deployment */
        :root {
            --color-primary: #1FB8CD;
            --color-primary-hover: #158fa0;
            --color-secondary: #FFC185;
            --color-background: #0a0a0a;
            --color-surface: #1a1a1a;
            --color-text: #ffffff;
            --color-text-secondary: #cccccc;
            --color-success: #28a745;
            --color-error: #dc3545;
            --color-warning: #ffc107;
            --color-material: #9d4edd;
            --color-material-hover: #7b2cbf;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            color: var(--color-text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Stars animation background */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .stars::before {
            content: '';
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            box-shadow:
                100px 200px 0 white,
                300px 100px 0 white,
                500px 300px 0 white,
                700px 150px 0 white,
                900px 250px 0 white,
                1100px 50px 0 white,
                150px 400px 0 white,
                350px 450px 0 white,
                550px 350px 0 white,
                750px 500px 0 white,
                950px 400px 0 white,
                1150px 450px 0 white,
                200px 600px 0 white,
                400px 550px 0 white,
                600px 650px 0 white,
                800px 600px 0 white,
                1000px 700px 0 white,
                1200px 650px 0 white;
            animation: twinkle 3s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        /* Screen management */
        .screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            overflow-y: auto;
            z-index: 1;
            padding: 20px;
        }

        .screen.active {
            opacity: 1;
            visibility: visible;
        }

        /* Welcome screen */
        .welcome-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            text-align: center;
            gap: 30px;
            max-width: 800px;
            margin: 0 auto;
        }

        .jwst-logo {
            font-size: 100px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        h1 {
            font-size: clamp(2rem, 5vw, 3.5rem);
            background: linear-gradient(45deg, var(--color-primary), var(--color-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        h2 {
            font-size: clamp(1.2rem, 3vw, 1.8rem);
            color: var(--color-text-secondary);
            font-weight: 300;
        }

        .welcome-description {
            font-size: clamp(1rem, 2.5vw, 1.2rem);
            line-height: 1.6;
            max-width: 600px;
            color: var(--color-text-secondary);
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            margin: 5px;
            touch-action: manipulation;
            user-select: none;
        }

        .btn--primary {
            background: linear-gradient(45deg, var(--color-primary), #20c997);
            color: white;
            box-shadow: 0 4px 15px rgba(31, 184, 205, 0.3);
        }

        .btn--primary:hover, .btn--primary:focus {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(31, 184, 205, 0.4);
        }

        .btn--outline {
            background: transparent;
            border: 2px solid var(--color-primary);
            color: var(--color-primary);
        }

        .btn--outline:hover, .btn--outline:focus {
            background: var(--color-primary);
            color: white;
        }

        .btn--lg {
            padding: 20px 40px;
            font-size: 18px;
        }

        /* Cards */
        .card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 30px;
            margin: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
            touch-action: manipulation;
        }

        .card:hover, .card:focus {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--color-primary);
        }

        /* Special styling for Materials card */
        .card.materials-card {
            background: linear-gradient(135deg, rgba(157, 78, 221, 0.1), rgba(123, 44, 191, 0.05));
            border-color: var(--color-material);
        }

        .card.materials-card:hover, .card.materials-card:focus {
            border-color: var(--color-material-hover);
            background: linear-gradient(135deg, rgba(157, 78, 221, 0.15), rgba(123, 44, 191, 0.08));
        }

        .card.materials-card h3 {
            color: var(--color-material);
        }

        .external-link-indicator {
            display: inline-block;
            margin-left: 8px;
            font-size: 0.8em;
            opacity: 0.8;
        }

        .level-cards, .mode-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .level-content, .mode-content {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Game content */
        .game-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .progress-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            height: 10px;
            width: 200px;
            overflow: hidden;
        }

        .progress-bar {
            background: linear-gradient(45deg, var(--color-primary), var(--color-secondary));
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
        }

        /* Canvas */
        canvas {
            border: 2px solid var(--color-primary);
            border-radius: 10px;
            background: #000;
            display: block;
            margin: 20px auto;
            max-width: 100%;
            height: auto;
        }

        /* Quiz styles */
        .quiz-options {
            display: grid;
            gap: 15px;
            margin: 30px 0;
        }

        .quiz-option {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid transparent;
            border-radius: 10px;
            padding: 20px;
            text-align: left;
            transition: all 0.3s ease;
            cursor: pointer;
            touch-action: manipulation;
        }

        .quiz-option:hover, .quiz-option:focus {
            background: rgba(31, 184, 205, 0.1);
            border-color: var(--color-primary);
        }

        .quiz-option.selected {
            background: var(--color-primary);
            color: white;
        }

        .quiz-option.correct {
            background: var(--color-success);
            color: white;
        }

        .quiz-option.incorrect {
            background: var(--color-error);
            color: white;
        }

        /* Feedback */
        .feedback {
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            display: none;
            font-weight: 600;
        }

        .feedback.show {
            display: block;
        }

        .feedback.correct {
            background: rgba(40, 167, 69, 0.2);
            border: 1px solid var(--color-success);
            color: var(--color-success);
        }

        .feedback.incorrect {
            background: rgba(220, 53, 69, 0.2);
            border: 1px solid var(--color-error);
            color: var(--color-error);
        }

        /* Results screen */
        .results-content {
            text-align: center;
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .results-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 40px 0;
            flex-wrap: wrap;
        }

        .stat-card {
            background: rgba(31, 184, 205, 0.1);
            border: 1px solid var(--color-primary);
            border-radius: 15px;
            padding: 30px;
            min-width: 150px;
        }

        .stat-value {
            font-size: clamp(2rem, 5vw, 3rem);
            font-weight: bold;
            color: var(--color-primary);
        }

        .stat-label {
            font-size: 1rem;
            color: var(--color-text-secondary);
            margin-top: 10px;
        }

        /* Achievements */
        .achievements-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }

        .achievement-badge {
            background: rgba(255, 193, 133, 0.1);
            border: 1px solid var(--color-secondary);
            border-radius: 25px;
            padding: 10px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal.hidden {
            display: none;
        }

        .modal-content {
            background: var(--color-surface);
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            border: 1px solid var(--color-primary);
        }

        .achievement-display {
            display: flex;
            align-items: center;
            gap: 20px;
            margin: 30px 0;
            text-align: left;
        }

        .achievement-icon {
            font-size: 60px;
        }

        /* Utility classes */
        .text-center { text-align: center; }
        .mb-20 { margin-bottom: 20px; }
        .mt-20 { margin-top: 20px; }
        .hidden { display: none; }

        /* Responsive design */
        @media (max-width: 768px) {
            .welcome-content {
                padding: 20px;
                gap: 20px;
            }

            .jwst-logo {
                font-size: 60px;
            }

            .level-cards, .mode-cards {
                grid-template-columns: 1fr;
            }

            .game-header {
                flex-direction: column;
                text-align: center;
            }

            .progress-container {
                width: 100%;
                max-width: 300px;
            }

            .results-stats {
                flex-direction: column;
                align-items: center;
            }

            .card {
                padding: 20px;
                margin: 10px;
            }

            canvas {
                width: 100%;
                max-width: 350px;
                height: auto;
            }
        }

        @media (max-width: 480px) {
            .btn {
                font-size: 14px;
                padding: 12px 24px;
            }

            .btn--lg {
                font-size: 16px;
                padding: 16px 32px;
            }

            .quiz-option {
                padding: 15px;
            }

            .modal-content {
                padding: 20px;
                margin: 20px;
            }
        }

        /* Loading state */
        .loading {
            opacity: 0.7;
            pointer-events: none;
        }

        /* Focus styles for accessibility */
        .btn:focus-visible,
        .quiz-option:focus-visible,
        .card:focus-visible {
            outline: 2px solid var(--color-primary);
            outline-offset: 2px;
        }

        /* Materials card focus style */
        .materials-card:focus-visible {
            outline: 2px solid var(--color-material);
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <!-- Animated stars background -->
    <div class="stars" aria-hidden="true"></div>

    <!-- Welcome Screen -->
    <div id="welcome-screen" class="screen active">
        <div class="welcome-content">
            <div class="jwst-logo" aria-hidden="true">🔭</div>
            <h1>JWST Educational Game</h1>
            <h2>Explore the Universe with Advanced Space Telescopes</h2>
            <p class="welcome-description">
                Embark on an interactive journey through space and time with the James Webb Space Telescope. 
                Test your knowledge with 75+ questions, master telescope focusing, and discover cosmic wonders.
            </p>
            
            <div class="welcome-buttons">
                <button id="start-btn" class="btn btn--primary btn--lg" aria-label="Start the space exploration game">
                    🚀 Start Exploration
                </button>
            </div>
            
            <div class="total-score-display">
                <strong>Total Score: <span id="total-score">0</span> points</strong>
            </div>
        </div>
    </div>

    <!-- Level Selection Screen -->
    <div id="level-screen" class="screen">
        <div class="level-content">
            <button class="btn btn--outline mb-20" onclick="switchScreen('welcome-screen')" aria-label="Go back to welcome screen">← Back</button>
            
            <h1 class="text-center mb-20">Choose Your Challenge Level</h1>
            <p class="text-center mb-20">Select the difficulty level that matches your space knowledge</p>
            
            <div class="level-cards">
                <div class="card level-card" data-level="easy" tabindex="0" role="button" aria-label="Easy level: Beginner Explorer">
                    <h3>🌟 Beginner Explorer</h3>
                    <p>Perfect for beginners</p>
                    <ul>
                        <li>30 basic space questions</li>
                        <li>Fundamental astronomy concepts</li>
                        <li>10 points per correct answer</li>
                    </ul>
                </div>
                
                <div class="card level-card" data-level="medium" tabindex="0" role="button" aria-label="Medium level: Space Enthusiast">
                    <h3>🌍 Space Enthusiast</h3>
                    <p>For space enthusiasts</p>
                    <ul>
                        <li>30 intermediate questions</li>
                        <li>Advanced telescope concepts</li>
                        <li>15 points per correct answer</li>
                    </ul>
                </div>
                
                <div class="card level-card" data-level="hard" tabindex="0" role="button" aria-label="Hard level: Astronomy Expert">
                    <h3>🎓 Astronomy Expert</h3>
                    <p>For astronomy experts</p>
                    <ul>
                        <li>15 expert-level questions</li>
                        <li>Advanced astrophysics</li>
                        <li>25 points per correct answer</li>
                    </ul>
                </div>
                
                <div class="card materials-card" data-level="materials" tabindex="0" role="button" aria-label="Materials Learning Session: 30 Comprehensive Chapters">
                    <a href = "https://rafiaya.github.io/chapters/" ><h3>📚 Advanced Learning Session<span class="external-link-indicator">↗</span></h3></a>
                    <p>Comprehensive space education</p>
                    <ul>
                        <li>30 detailed chapters</li>
                        <li>NASA, telescopes, space exploration</li>
                        <li>ISS, probes & more</li>
                        <li>Complete learning experience</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Mode Selection Screen -->
    <div id="mode-screen" class="screen">
        <div class="mode-content">
            <button class="btn btn--outline mb-20" onclick="switchScreen('level-screen')" aria-label="Go back to level selection">← Back</button>
            
            <h1 class="text-center mb-20">Choose Your Adventure</h1>
            <p class="text-center">Current Level: <span id="current-level">Easy</span> | Total Score: <span id="total-score-mode">0</span> points</p>
            
            <div class="mode-cards">
                <div class="card mode-card" data-mode="quiz" tabindex="0" role="button" aria-label="Knowledge Quiz mode">
                    <h3>🧠 Knowledge Quiz</h3>
                    <p>Test your understanding with 10+ questions per session</p>
                </div>
                
                <div class="card mode-card" data-mode="compare" tabindex="0" role="button" aria-label="Telescope Comparison mode">
                    <h3>🔄 Telescope Comparison</h3>
                    <p>Compare images from different space telescopes</p>
                </div>
                
                <div class="card mode-card" data-mode="focus" tabindex="0" role="button" aria-label="Focus Challenge mode">
                    <h3>🎯 Focus Challenge</h3>
                    <p>Master telescope focusing techniques</p>
                </div>
                
                <div class="card mode-card" data-mode="gallery" tabindex="0" role="button" aria-label="Cosmic Gallery mode">
                    <h3>🌌 Cosmic Gallery</h3>
                    <p>Explore spectacular cosmic objects</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Quiz Game Screen -->
    <div id="quiz-screen" class="screen">
        <div class="game-content">
            <button class="btn btn--outline mb-20" onclick="switchScreen('mode-screen')" aria-label="Go back to mode selection">← Back</button>
            
            <div class="game-header">
                <div>
                    <h2>Space Knowledge Quiz</h2>
                    <div id="quiz-question-number" aria-live="polite">Question 1 of 10</div>
                </div>
                <div class="progress-container" role="progressbar" aria-label="Quiz progress">
                    <div id="quiz-progress" class="progress-bar"></div>
                </div>
            </div>
            
            <div class="game-area">
                <h3 id="quiz-question" class="mb-20">Loading question...</h3>
                <div id="quiz-options" class="quiz-options" role="radiogroup" aria-label="Answer options"></div>
                <div id="quiz-feedback" class="feedback" aria-live="polite"></div>
                <button id="quiz-next" class="btn btn--primary mt-20 hidden">Next Question →</button>
            </div>
        </div>
    </div>

    <!-- Focus Challenge Screen -->
    <div id="focus-screen" class="screen">
        <div class="game-content">
            <button class="btn btn--outline mb-20" onclick="switchScreen('mode-screen')" aria-label="Go back to mode selection">← Back</button>
            
            <div class="game-header">
                <h2>Telescope Focus Challenge</h2>
                <div class="progress-container" role="progressbar" aria-label="Focus challenge progress">
                    <div id="focus-progress" class="progress-bar"></div>
                </div>
            </div>
            
            <div class="game-area text-center">
                <canvas id="focus-canvas" width="400" height="300" aria-label="Telescope focus simulation"></canvas>
                <p>Adjust the focus to get the clearest image possible!</p>
                
                <div class="focus-controls">
                    <input type="range" id="focus-slider" min="0" max="100" value="0" 
                           style="width: 100%; margin: 20px 0;" 
                           aria-label="Focus adjustment slider">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                        <span>Blurry</span>
                        <span>Perfect Focus</span>
                        <span>Overfocused</span>
                    </div>
                    <button id="focus-submit" class="btn btn--primary">Submit Focus</button>
                </div>
                
                <div id="focus-feedback" class="feedback" aria-live="polite"></div>
            </div>
        </div>
    </div>

    <!-- Telescope Comparison Screen -->
    <div id="compare-screen" class="screen">
        <div class="game-content">
            <button class="btn btn--outline mb-20" onclick="switchScreen('mode-screen')" aria-label="Go back to mode selection">← Back</button>
            
            <div class="game-header">
                <h2>Telescope Comparison Challenge</h2>
                <div class="progress-container" role="progressbar" aria-label="Comparison challenge progress">
                    <div id="compare-progress" class="progress-bar"></div>
                </div>
            </div>
            
            <div class="game-area text-center">
                <canvas id="compare-canvas" width="400" height="300" aria-label="Telescope comparison image"></canvas>
                <h3 id="compare-question" class="mb-20">Which telescope captured this image?</h3>
                
                <div style="display: flex; justify-content: center; gap: 15px; flex-wrap: wrap;" role="radiogroup" aria-label="Telescope options">
                    <button class="btn btn--outline telescope-btn" data-telescope="JWST" role="radio" aria-checked="false">James Webb</button>
                    <button class="btn btn--outline telescope-btn" data-telescope="Hubble" role="radio" aria-checked="false">Hubble</button>
                    <button class="btn btn--outline telescope-btn" data-telescope="Spitzer" role="radio" aria-checked="false">Spitzer</button>
                </div>
                
                <div id="compare-feedback" class="feedback" aria-live="polite"></div>
            </div>
        </div>
    </div>

    <!-- Gallery Screen -->
    <div id="gallery-screen" class="screen">
        <div class="game-content">
            <button class="btn btn--outline mb-20" onclick="switchScreen('mode-screen')" aria-label="Go back to mode selection">← Back</button>
            
            <h1 class="text-center mb-20">🌌 Cosmic Gallery</h1>
            <p class="text-center mb-20">Explore the magnificent cosmic objects discovered by space telescopes</p>
            
            <div id="gallery-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                <!-- Gallery items will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Results Screen -->
    <div id="results-screen" class="screen">
        <div class="results-content">
            <h1>🎉 Mission Complete!</h1>
            
            <div class="results-stats">
                <div class="stat-card">
                    <div class="stat-value" id="final-score">0</div>
                    <div class="stat-label">Total Points</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="accuracy">0%</div>
                    <div class="stat-label">Accuracy</div>
                </div>
            </div>
            
            <div class="achievements mb-20">
                <h3>🏆 Achievements Unlocked</h3>
                <div id="achievements-list" class="achievements-list"></div>
            </div>
            
            <div class="card mb-20">
                <h3>🧠 Did You Know?</h3>
                <p id="educational-fact">The James Webb Space Telescope can see light that has traveled for over 13 billion years!</p>
            </div>
            
            <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                <button class="btn btn--primary" onclick="switchScreen('mode-screen')">🔄 Play Again</button>
                <button class="btn btn--outline" onclick="switchScreen('welcome-screen')">🏠 Main Menu</button>
            </div>
        </div>
    </div>

    <!-- Achievement Modal -->
    <div id="achievement-modal" class="modal hidden" role="dialog" aria-labelledby="modal-achievement-name" aria-describedby="modal-achievement-desc">
        <div class="modal-content">
            <h2>🎊 Achievement Unlocked!</h2>
            <div class="achievement-display">
                <div class="achievement-icon" id="modal-achievement-icon" aria-hidden="true">🏆</div>
                <div>
                    <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 10px;" id="modal-achievement-name">Achievement Name</div>
                    <div id="modal-achievement-desc">Achievement description</div>
                </div>
            </div>
            <button class="btn btn--primary" onclick="closeModal()">Continue Exploring</button>
        </div>
    </div>

    <script>
        // EMBEDDED JAVASCRIPT - Complete game logic optimized with Materials integration
        
        // Game Data (Embedded JSON)
        const GAME_DATA = {
            telescopes: [
                {
                    name: "James Webb Space Telescope",
                    shortName: "JWST",
                    launchYear: 2021,
                    type: "Infrared",
                    features: ["6.5m segmented mirror", "Infrared observations", "Ultra-deep field imaging"],
                    color: "#1FB8CD"
                },
                {
                    name: "Hubble Space Telescope",
                    shortName: "Hubble",
                    launchYear: 1990,
                    type: "Optical/UV",
                    features: ["2.4m mirror", "Visible light imaging", "High resolution imaging"],
                    color: "#FFC185"
                },
                {
                    name: "Spitzer Space Telescope",
                    shortName: "Spitzer",
                    launchYear: 2003,
                    type: "Infrared",
                    features: ["0.85m mirror", "Mid-infrared observations", "Dust penetration"],
                    color: "#B4413C"
                }
            ],
            achievements: [
                {id: "first_focus", name: "First Focus", description: "Complete your first focus challenge", icon: "🔭"},
                {id: "telescope_expert", name: "Telescope Expert", description: "Correctly identify 10 telescope images", icon: "🏆"},
                {id: "quiz_master", name: "Quiz Master", description: "Answer 5 quiz questions correctly in a row", icon: "🧠"},
                {id: "explorer", name: "Explorer", description: "Visit all sections of the game", icon: "🚀"},
                {id: "perfect_vision", name: "Perfect Vision", description: "Complete a focus challenge with perfect accuracy", icon: "👁️"},
                {id: "knowledge_seeker", name: "Knowledge Seeker", description: "Answer 10 questions correctly", icon: "📚"},
                {id: "material_scholar", name: "Material Scholar", description: "Access the advanced learning materials", icon: "🎓"}
            ],
            cosmicObjects: [
                {name: "Carina Nebula", type: "Star-forming region", distance: "7,500 light-years"},
                {name: "SMACS 0723", type: "Galaxy cluster", distance: "4.6 billion light-years"},
                {name: "Stephan's Quintet", type: "Galaxy group", distance: "290 million light-years"},
                {name: "Southern Ring Nebula", type: "Planetary nebula", distance: "2,000 light-years"},
                {name: "WASP-96b", type: "Exoplanet", distance: "1,150 light-years"}
            ],
            materialsUrl: "https://rafiaya.github.io/chapters/"
        };

        // Questions Data (All 75 questions embedded)
        const QUESTIONS_DATA = {
            easy: [
                {
                    question: "What does NASA stand for?",
                    options: ["National Aeronautics and Space Administration", "National Aviation and Space Agency", "North American Space Association", "National Aerospace Administration"],
                    correct: 0,
                    explanation: "NASA stands for National Aeronautics and Space Administration, established in 1958."
                },
                {
                    question: "Which telescope is considered the successor to Hubble?",
                    options: ["Spitzer Space Telescope", "Kepler Space Telescope", "James Webb Space Telescope", "Chandra X-ray Observatory"],
                    correct: 2,
                    explanation: "The James Webb Space Telescope is designed as Hubble's successor, with enhanced infrared capabilities."
                },
                {
                    question: "Which country was the first to send a human into space?",
                    options: ["United States", "Soviet Union (Russia)", "China", "Germany"],
                    correct: 1,
                    explanation: "The Soviet Union sent Yuri Gagarin into space on April 12, 1961."
                },
                {
                    question: "What is our galaxy called?",
                    options: ["Andromeda Galaxy", "The Milky Way", "Whirlpool Galaxy", "Magellanic Clouds"],
                    correct: 1,
                    explanation: "Our galaxy is called the Milky Way, a barred spiral galaxy containing over 100 billion stars."
                },
                {
                    question: "Who was the first human to step on the Moon?",
                    options: ["Buzz Aldrin", "Neil Armstrong", "Michael Collins", "John Glenn"],
                    correct: 1,
                    explanation: "Neil Armstrong was the first person to walk on the Moon during the Apollo 11 mission on July 20, 1969."
                },
                {
                    question: "Which private company developed the Falcon 9 rocket?",
                    options: ["Blue Origin", "SpaceX", "Virgin Galactic", "Boeing"],
                    correct: 1,
                    explanation: "SpaceX, founded by Elon Musk, developed the Falcon 9 rocket series."
                },
                {
                    question: "What is the main function of the International Space Station?",
                    options: ["Space tourism", "A space laboratory for research and experiments", "Satellite repair", "Moon mission preparation"],
                    correct: 1,
                    explanation: "The ISS serves as a microgravity laboratory where astronauts conduct scientific research."
                },
                {
                    question: "Which planet has been explored by rovers like Curiosity and Perseverance?",
                    options: ["Venus", "Mars", "Jupiter", "Saturn"],
                    correct: 1,
                    explanation: "NASA's Curiosity and Perseverance rovers have been exploring Mars."
                },
                {
                    question: "What theory explains the origin of the universe?",
                    options: ["Steady State Theory", "The Big Bang Theory", "Multiverse Theory", "Cyclic Model"],
                    correct: 1,
                    explanation: "The Big Bang Theory explains how the universe began from a singularity and has been expanding ever since."
                },
                {
                    question: "What is the name of the first artificial satellite?",
                    options: ["Explorer 1", "Sputnik 1", "Telstar", "Vanguard 1"],
                    correct: 1,
                    explanation: "Sputnik 1 was launched by the Soviet Union on October 4, 1957."
                },
                {
                    question: "Which telescope has captured some of the deepest images of the universe?",
                    options: ["James Webb Space Telescope", "Hubble Space Telescope", "Spitzer Space Telescope", "Kepler Space Telescope"],
                    correct: 1,
                    explanation: "Hubble Space Telescope has captured iconic deep field images showing galaxies billions of light-years away."
                },
                {
                    question: "What is the closest star to our solar system?",
                    options: ["Alpha Centauri", "Sirius", "Vega", "Polaris"],
                    correct: 0,
                    explanation: "Alpha Centauri is the closest star system to our solar system at about 4.37 light-years away."
                },
                {
                    question: "How many planets are in our solar system?",
                    options: ["7", "8", "9", "10"],
                    correct: 1,
                    explanation: "Our solar system has 8 planets: Mercury, Venus, Earth, Mars, Jupiter, Saturn, Uranus, and Neptune."
                },
                {
                    question: "What causes the seasons on Earth?",
                    options: ["Distance from the Sun", "Earth's axial tilt", "Solar flares", "Moon's gravity"],
                    correct: 1,
                    explanation: "Earth's seasons are caused by the planet's 23.5-degree axial tilt as it orbits the Sun."
                },
                {
                    question: "What is the largest planet in our solar system?",
                    options: ["Saturn", "Jupiter", "Neptune", "Uranus"],
                    correct: 1,
                    explanation: "Jupiter is the largest planet in our solar system, with a mass greater than all other planets combined."
                },
                {
                    question: "Which space agency launched the Curiosity rover?",
                    options: ["ESA", "NASA", "Roscosmos", "JAXA"],
                    correct: 1,
                    explanation: "NASA's Curiosity rover was launched in 2011 and landed on Mars in 2012."
                },
                {
                    question: "What is a light-year?",
                    options: ["A unit of time", "A unit of distance", "A type of star", "A space mission"],
                    correct: 1,
                    explanation: "A light-year is the distance light travels in one year, approximately 9.46 trillion kilometers."
                },
                {
                    question: "Which planet is known as the Red Planet?",
                    options: ["Venus", "Mars", "Jupiter", "Saturn"],
                    correct: 1,
                    explanation: "Mars is known as the Red Planet due to iron oxide (rust) on its surface."
                },
                {
                    question: "What is the name of the galaxy nearest to the Milky Way?",
                    options: ["Triangulum Galaxy", "Andromeda Galaxy", "Whirlpool Galaxy", "Sombrero Galaxy"],
                    correct: 1,
                    explanation: "The Andromeda Galaxy is the nearest major galaxy to the Milky Way, about 2.5 million light-years away."
                },
                {
                    question: "Which Apollo mission first landed humans on the Moon?",
                    options: ["Apollo 10", "Apollo 11", "Apollo 12", "Apollo 13"],
                    correct: 1,
                    explanation: "Apollo 11 was the first mission to successfully land humans on the Moon in July 1969."
                }
            ],
            medium: [
                {
                    question: "What evidence supports the Big Bang Theory?",
                    options: ["Only fossil records", "The expansion of the universe, cosmic microwave background radiation", "Solar system formation", "Black hole observations"],
                    correct: 1,
                    explanation: "The Big Bang Theory is supported by universal expansion, cosmic microwave background radiation, and light element abundance."
                },
                {
                    question: "Why is the James Webb Space Telescope more powerful than Hubble?",
                    options: ["It's closer to Earth", "It observes in infrared, has a larger mirror, and can see farther back in time", "It uses nuclear power", "It has more computers"],
                    correct: 1,
                    explanation: "JWST's 6.5m infrared mirror allows it to observe the early universe and see through cosmic dust better than Hubble."
                },
                {
                    question: "What role does dark energy play in the universe?",
                    options: ["It creates new stars", "It is responsible for the accelerated expansion of the universe", "It forms black holes", "It powers telescopes"],
                    correct: 1,
                    explanation: "Dark energy causes the universe's expansion to accelerate, making up about 68% of the universe."
                },
                {
                    question: "What is stellar nucleosynthesis?",
                    options: ["Star navigation", "The process by which stars fuse elements in their cores, creating heavier elements", "Star destruction", "Star classification"],
                    correct: 1,
                    explanation: "Stellar nucleosynthesis is the nuclear fusion process in stars that creates heavier elements from lighter ones."
                },
                {
                    question: "What is an exoplanet?",
                    options: ["A former planet", "A planet orbiting a star outside our solar system", "A very large planet", "A planet without moons"],
                    correct: 1,
                    explanation: "An exoplanet is any planet that orbits a star other than our Sun."
                },
                {
                    question: "Why was the Hubble Space Telescope placed in orbit?",
                    options: ["To be closer to stars", "To avoid atmospheric distortion and capture clearer images", "To save money", "To study the Moon better"],
                    correct: 1,
                    explanation: "Placing Hubble above Earth's atmosphere eliminates atmospheric interference."
                },
                {
                    question: "What is a neutron star?",
                    options: ["A new type of star", "A super-dense remnant of a massive star after a supernova explosion", "A star made of gas", "A failed star"],
                    correct: 1,
                    explanation: "Neutron stars are incredibly dense stellar remnants formed in supernova explosions."
                },
                {
                    question: "How are stars formed from nebulae?",
                    options: ["They appear instantly", "Gas and dust collapse under gravity, forming protostars that ignite nuclear fusion", "They migrate from other galaxies", "They split from existing stars"],
                    correct: 1,
                    explanation: "Star formation occurs when dense regions collapse under gravity until nuclear fusion begins."
                },
                {
                    question: "What happens when a massive star dies?",
                    options: ["It becomes a planet", "It may explode as a supernova, leaving behind a neutron star or black hole", "It just disappears", "It becomes a comet"],
                    correct: 1,
                    explanation: "Massive stars end in supernova explosions, leaving neutron stars or black holes."
                },
                {
                    question: "What is dark matter and why is it important?",
                    options: ["Visible black material", "Invisible mass that holds galaxies together and makes up most of the universe's matter", "Empty space", "Dead stars"],
                    correct: 1,
                    explanation: "Dark matter provides gravitational scaffolding for galaxy formation and makes up about 27% of the universe."
                },
                {
                    question: "How do astronomers measure distances to far galaxies?",
                    options: ["Direct measurement with rulers", "Using standard candles like Type Ia supernovae and Cepheid variables", "Guessing based on brightness", "Time travel"],
                    correct: 1,
                    explanation: "Astronomers use standard candles - objects with known intrinsic brightness - to calculate distances via the inverse square law."
                },
                {
                    question: "What is the significance of the cosmic microwave background?",
                    options: ["It's just random noise", "It's the afterglow of the Big Bang, providing evidence for the hot, dense early universe", "It comes from nearby stars", "It's caused by Earth's atmosphere"],
                    correct: 1,
                    explanation: "The CMB is radiation left over from when the universe became transparent, about 380,000 years after the Big Bang."
                },
                {
                    question: "Why do galaxies rotate faster than expected?",
                    options: ["They don't rotate faster than expected", "Dark matter provides additional gravitational mass not visible to telescopes", "Stars are moving randomly", "Black holes accelerate rotation"],
                    correct: 1,
                    explanation: "Galaxy rotation curves remain flat at large radii, indicating invisible dark matter provides additional gravitational influence."
                },
                {
                    question: "What is the main sequence on the Hertzsprung-Russell diagram?",
                    options: ["A line of dead stars", "The evolutionary track where stars spend most of their lives fusing hydrogen", "A classification of planets", "A telescope alignment procedure"],
                    correct: 1,
                    explanation: "The main sequence represents stars in hydrostatic equilibrium, steadily fusing hydrogen in their cores."
                },
                {
                    question: "How do binary star systems help astronomers?",
                    options: ["They don't help at all", "They allow direct measurement of stellar masses through orbital mechanics", "They only look pretty", "They block other stars"],
                    correct: 1,
                    explanation: "Binary systems enable mass determination via Kepler's laws and provide laboratories for stellar evolution studies."
                }
            ],
            hard: [
                {
                    question: "Why is the James Webb Space Telescope positioned at the L2 Lagrange point?",
                    options: ["It's the closest point to stars", "L2 offers gravitational stability and constant shielding from Sun, Earth, and Moon", "It's the cheapest location", "It provides the best view of all planets"],
                    correct: 1,
                    explanation: "The L2 Lagrange point provides gravitational stability allowing JWST to maintain position with minimal fuel, while the sunshield can simultaneously block radiation from multiple sources."
                },
                {
                    question: "How do gravitational wave observations complement electromagnetic observations?",
                    options: ["They replace electromagnetic observations", "Gravitational waves probe events like black hole mergers invisible to light, forming 'multi-messenger astronomy'", "They only work on Earth", "They are less accurate"],
                    correct: 1,
                    explanation: "Gravitational waves detect spacetime distortions from events invisible to light, providing complementary information about cosmic phenomena."
                },
                {
                    question: "What engineering challenges make interstellar travel fundamentally harder than interplanetary travel?",
                    options: ["Only distance matters", "Requires propulsion beyond chemical rockets, cosmic ray protection, sustainable life support, and unprecedented energy", "Only time matters", "It's just more expensive"],
                    correct: 1,
                    explanation: "Interstellar travel requires revolutionary propulsion, radiation shielding, and life support systems far beyond current capabilities."
                },
                {
                    question: "How does dark matter influence galaxy rotation curves?",
                    options: ["It makes galaxies spin faster everywhere", "Dark matter provides additional unseen mass explaining why rotation curves remain flat at large radii", "It only affects galaxy centers", "It slows down galaxy rotation"],
                    correct: 1,
                    explanation: "Dark matter explains why galaxy rotation curves stay flat instead of declining as predicted by visible matter alone."
                },
                {
                    question: "Why is detecting biosignatures in exoplanet atmospheres extremely difficult?",
                    options: ["Planets are too small", "Requires separating faint planetary signals from bright starlight and distinguishing biological from non-biological processes", "We lack the technology", "Atmospheres change too quickly"],
                    correct: 1,
                    explanation: "Biosignature detection requires extraordinary precision to isolate weak signals and eliminate false positives from abiotic processes."
                }
            ]
        };

        // Main Game Class
        class JWSTGame {
            constructor() {
                this.currentScreen = 'welcome-screen';
                this.currentLevel = 'easy';
                this.totalScore = this.loadScore();
                this.gameScores = {compare: 0, focus: 0, quiz: 0, materials: 0};
                this.achievements = new Set(this.loadAchievements());
                
                // Game states
                this.quizState = {
                    currentQuestion: 0,
                    totalQuestions: 10,
                    score: 0,
                    correctStreak: 0,
                    questions: []
                };
                
                this.focusState = {
                    currentChallenge: 0,
                    totalChallenges: 3,
                    score: 0,
                    targetFocus: 0,
                    submitted: false
                };
                
                this.compareState = {
                    currentQuestion: 0,
                    totalQuestions: 5,
                    score: 0,
                    questions: [],
                    answered: false
                };
            }

            init() {
                console.log('🔭 Initializing JWST Educational Game with Materials Integration');
                this.setupEventListeners();
                this.updateScoreDisplay();
                this.showGallery(); // Pre-populate gallery
                
                // Analytics (if needed)
                this.trackEvent('game_initialized');
                
                console.log('✅ Game initialized successfully');
                console.log('📊 Game Statistics:');
                console.log('- Easy Questions:', QUESTIONS_DATA.easy.length);
                console.log('- Medium Questions:', QUESTIONS_DATA.medium.length);  
                console.log('- Hard Questions:', QUESTIONS_DATA.hard.length);
                console.log('- Total Questions:', Object.values(QUESTIONS_DATA).flat().length);
                console.log('- Telescopes:', GAME_DATA.telescopes.length);
                console.log('- Achievements:', GAME_DATA.achievements.length);
                console.log('- Materials URL:', GAME_DATA.materialsUrl);
            }

            setupEventListeners() {
                // Start button
                document.getElementById('start-btn').addEventListener('click', () => {
                    this.switchScreen('level-screen');
                    this.trackEvent('game_started');
                });

                // Level selection with keyboard support and Materials handling
                document.querySelectorAll('.level-card').forEach(card => {
                    const clickHandler = () => {
                        const level = card.dataset.level;
                        
                        // Special handling for Materials
                        if (level === 'materials') {
                            this.openMaterialsSession();
                            return;
                        }
                        
                        // Regular level selection
                        this.currentLevel = level;
                        this.updateLevelDisplay();
                        this.switchScreen('mode-screen');
                        this.trackEvent('level_selected', {level: this.currentLevel});
                    };
                    
                    card.addEventListener('click', clickHandler);
                    card.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            clickHandler();
                        }
                    });
                });

                // Mode selection with keyboard support
                document.querySelectorAll('.mode-card').forEach(card => {
                    const clickHandler = () => {
                        this.startGameMode(card.dataset.mode);
                        this.checkAchievement('explorer');
                    };
                    
                    card.addEventListener('click', clickHandler);
                    card.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            clickHandler();
                        }
                    });
                });

                // Quiz next button
                document.getElementById('quiz-next').addEventListener('click', () => {
                    this.nextQuizQuestion();
                });

                // Focus controls
                document.getElementById('focus-slider').addEventListener('input', (e) => {
                    this.updateFocusView(parseInt(e.target.value));
                });
                
                document.getElementById('focus-submit').addEventListener('click', () => {
                    this.submitFocus();
                });

                // Telescope comparison buttons
                document.querySelectorAll('.telescope-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        if (!this.compareState.answered) {
                            this.answerCompareQuestion(btn.dataset.telescope);
                            // Update aria-checked
                            document.querySelectorAll('.telescope-btn').forEach(b => {
                                b.setAttribute('aria-checked', 'false');
                            });
                            btn.setAttribute('aria-checked', 'true');
                        }
                    });
                });
                
                // Error handling for failed operations
                window.addEventListener('error', (event) => {
                    console.error('Game error:', event.error);
                    this.trackEvent('error', {message: event.error?.message});
                });
            }

            // New method to handle Materials session
            openMaterialsSession() {
                console.log('Opening Materials Learning Session');
                
                // Award achievement for accessing materials
                this.checkAchievement('material_scholar');
                
                // Add points for accessing materials
                this.gameScores.materials += 50;
                this.totalScore += 50;
                this.saveScore();
                this.updateScoreDisplay();
                
                // Track the event
                this.trackEvent('materials_accessed', {url: GAME_DATA.materialsUrl});
                
                // Show confirmation before opening external site
                const userConfirmed = confirm(
                    '🚀 Opening Advanced Learning Session!\n\n' +
                    'This will open a comprehensive 30-chapter course covering:\n' +
                    '• NASA History & Achievements\n' +
                    '• Space Telescopes & Technology\n' +
                    '• International Space Station\n' +
                    '• Space Exploration & Probes\n' +
                    '• Astronomy & Astrophysics\n\n' +
                    'Continue to external learning platform?'
                );
                
                if (userConfirmed) {
                    // Open materials in new tab/window
                    window.open(GAME_DATA.materialsUrl, '_blank', 'noopener,noreferrer');
                    
                    // Show achievement modal if first time
                    if (!this.achievements.has('material_scholar')) {
                        const achievement = GAME_DATA.achievements.find(a => a.id === 'material_scholar');
                        if (achievement) {
                            setTimeout(() => {
                                this.showAchievementModal(achievement);
                            }, 500);
                        }
                    }
                } else {
                    console.log('User cancelled materials access');
                }
            }

            switchScreen(screenId) {
                document.querySelectorAll('.screen').forEach(screen => {
                    screen.classList.remove('active');
                });
                
                const newScreen = document.getElementById(screenId);
                if (newScreen) {
                    newScreen.classList.add('active');
                    this.currentScreen = screenId;
                    
                    // Accessibility: focus management
                    setTimeout(() => {
                        const firstFocusable = newScreen.querySelector('button, [tabindex="0"]');
                        if (firstFocusable) {
                            firstFocusable.focus();
                        }
                    }, 100);
                } else {
                    console.error('Screen not found:', screenId);
                }
            }

            updateLevelDisplay() {
                const levelEl = document.getElementById('current-level');
                if (levelEl) {
                    levelEl.textContent = this.currentLevel.charAt(0).toUpperCase() + this.currentLevel.slice(1);
                }
            }

            startGameMode(mode) {
                this.trackEvent('mode_started', {mode, level: this.currentLevel});
                
                switch(mode) {
                    case 'quiz':
                        this.startQuizGame();
                        break;
                    case 'compare':
                        this.startCompareGame();
                        break;
                    case 'focus':
                        this.startFocusGame();
                        break;
                    case 'gallery':
                        this.switchScreen('gallery-screen');
                        break;
                    default:
                        console.error('Unknown game mode:', mode);
                }
            }

            // Quiz Game
            startQuizGame() {
                this.switchScreen('quiz-screen');
                this.quizState = {
                    currentQuestion: 0,
                    totalQuestions: 10,
                    score: 0,
                    correctStreak: 0,
                    questions: this.generateQuizQuestions()
                };
                this.showQuizQuestion();
                this.updateProgress('quiz-progress', 0);
            }

            generateQuizQuestions() {
                const questions = QUESTIONS_DATA[this.currentLevel] || QUESTIONS_DATA.easy;
                const shuffled = [...questions].sort(() => Math.random() - 0.5);
                return shuffled.slice(0, Math.min(10, shuffled.length));
            }

            showQuizQuestion() {
                const question = this.quizState.questions[this.quizState.currentQuestion];
                if (!question) {
                    console.error('No question available');
                    return;
                }
                
                document.getElementById('quiz-question').textContent = question.question;
                document.getElementById('quiz-question-number').textContent = 
                    `Question ${this.quizState.currentQuestion + 1} of ${this.quizState.questions.length}`;

                const optionsContainer = document.getElementById('quiz-options');
                optionsContainer.innerHTML = '';

                question.options.forEach((option, index) => {
                    const button = document.createElement('button');
                    button.className = 'quiz-option';
                    button.textContent = option;
                    button.setAttribute('role', 'radio');
                    button.setAttribute('aria-checked', 'false');
                    button.onclick = () => this.answerQuizQuestion(index);
                    optionsContainer.appendChild(button);
                });

                document.getElementById('quiz-feedback').classList.remove('show', 'correct', 'incorrect');
                document.getElementById('quiz-next').classList.add('hidden');
            }

            answerQuizQuestion(selectedIndex) {
                const question = this.quizState.questions[this.quizState.currentQuestion];
                const correct = selectedIndex === question.correct;

                document.querySelectorAll('.quiz-option').forEach((btn, index) => {
                    btn.style.pointerEvents = 'none';
                    btn.setAttribute('aria-checked', index === selectedIndex ? 'true' : 'false');
                    
                    if (index === question.correct) {
                        btn.classList.add('correct');
                    } else if (index === selectedIndex && !correct) {
                        btn.classList.add('incorrect');
                    }
                });

                const feedback = document.getElementById('quiz-feedback');
                feedback.classList.add('show', correct ? 'correct' : 'incorrect');
                feedback.innerHTML = (correct ? '✅ Correct!' : '❌ Incorrect.') + '<br><em>' + question.explanation + '</em>';

                if (correct) {
                    this.quizState.score += this.getPointsForLevel();
                    this.quizState.correctStreak++;
                    
                    if (this.quizState.correctStreak >= 5) {
                        this.checkAchievement('quiz_master');
                    }
                } else {
                    this.quizState.correctStreak = 0;
                }

                this.trackEvent('question_answered', {
                    correct, 
                    level: this.currentLevel,
                    questionIndex: this.quizState.currentQuestion
                });

                document.getElementById('quiz-next').classList.remove('hidden');
            }

            nextQuizQuestion() {
                this.quizState.currentQuestion++;
                if (this.quizState.currentQuestion < this.quizState.questions.length) {
                    this.showQuizQuestion();
                    this.updateProgress('quiz-progress', 
                        (this.quizState.currentQuestion / this.quizState.questions.length) * 100);
                } else {
                    this.finishQuizGame();
                }
            }

            finishQuizGame() {
                this.gameScores.quiz = this.quizState.score;
                this.totalScore += this.quizState.score;
                
                if (this.quizState.score >= this.getPointsForLevel() * 10) {
                    this.checkAchievement('knowledge_seeker');
                }
                
                this.trackEvent('quiz_completed', {
                    score: this.quizState.score,
                    level: this.currentLevel,
                    accuracy: this.quizState.score / (this.quizState.questions.length * this.getPointsForLevel())
                });
                
                this.showResults('quiz');
            }

            // Focus Challenge Game
            startFocusGame() {
                this.switchScreen('focus-screen');
                this.focusState = {
                    currentChallenge: 0,
                    totalChallenges: 3,
                    score: 0,
                    targetFocus: Math.floor(Math.random() * 80) + 10,
                    submitted: false
                };
                this.updateFocusView(0);
                this.updateProgress('focus-progress', 0);
            }

            updateFocusView(focusValue) {
                const canvas = document.getElementById('focus-canvas');
                if (!canvas) return;

                const ctx = canvas.getContext('2d');
                const width = canvas.width;
                const height = canvas.height;
                const blurAmount = Math.abs(focusValue - this.focusState.targetFocus) / 2;

                // Clear and set background
                ctx.fillStyle = '#000033';
                ctx.fillRect(0, 0, width, height);

                // Draw stars with blur effect
                ctx.save();
                for (let i = 0; i < 20; i++) {
                    ctx.globalAlpha = Math.max(0.3, 1 - blurAmount / 50);
                    ctx.fillStyle = '#ffffff';
                    ctx.beginPath();
                    ctx.arc(
                        50 + i * 30,
                        50 + (i % 4) * 60,
                        Math.max(1, 3 - blurAmount / 20),
                        0, 2 * Math.PI
                    );
                    ctx.fill();
                }
                ctx.restore();

                // Draw central galaxy with blur
                const gradient = ctx.createRadialGradient(width/2, height/2, 0, width/2, height/2, 80);
                gradient.addColorStop(0, '#ff6b9d');
                gradient.addColorStop(0.5, '#4ecdc4');
                gradient.addColorStop(1, '#45b7d1');
                
                ctx.save();
                if (ctx.filter) {
                    ctx.filter = `blur(${Math.max(0, blurAmount / 10)}px)`;
                }
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(width/2, height/2, 60, 0, 2 * Math.PI);
                ctx.fill();
                ctx.restore();
            }

            submitFocus() {
                if (this.focusState.submitted) return;
                
                this.focusState.submitted = true;
                const slider = document.getElementById('focus-slider');
                const focusValue = parseInt(slider.value);
                const difference = Math.abs(focusValue - this.focusState.targetFocus);
                
                const feedback = document.getElementById('focus-feedback');
                feedback.classList.add('show');
                
                let points = 0;
                if (difference <= 5) {
                    feedback.classList.add('correct');
                    feedback.textContent = '🎯 Perfect focus! Amazing precision!';
                    points = this.getPointsForLevel() * 2;
                    this.checkAchievement('perfect_vision');
                } else if (difference <= 15) {
                    feedback.classList.add('correct');
                    feedback.textContent = '✅ Great focus! Very close to perfect.';
                    points = this.getPointsForLevel();
                } else {
                    feedback.classList.add('incorrect');
                    feedback.textContent = `❌ Focus was off by ${difference}%. Keep practicing!`;
                }

                this.focusState.score += points;
                
                if (this.focusState.currentChallenge === 0) {
                    this.checkAchievement('first_focus');
                }

                this.trackEvent('focus_submitted', {
                    difference,
                    points,
                    challenge: this.focusState.currentChallenge
                });

                setTimeout(() => {
                    this.focusState.currentChallenge++;
                    if (this.focusState.currentChallenge < this.focusState.totalChallenges) {
                        this.focusState.targetFocus = Math.floor(Math.random() * 80) + 10;
                        this.focusState.submitted = false;
                        slider.value = 0;
                        this.updateFocusView(0);
                        feedback.classList.remove('show', 'correct', 'incorrect');
                        this.updateProgress('focus-progress', 
                            (this.focusState.currentChallenge / this.focusState.totalChallenges) * 100);
                    } else {
                        this.finishFocusGame();
                    }
                }, 2500);
            }

            finishFocusGame() {
                this.gameScores.focus = this.focusState.score;
                this.totalScore += this.focusState.score;
                this.trackEvent('focus_completed', {score: this.focusState.score});
                this.showResults('focus');
            }

            // Telescope Comparison Game
            startCompareGame() {
                this.switchScreen('compare-screen');
                this.compareState = {
                    currentQuestion: 0,
                    totalQuestions: 5,
                    score: 0,
                    questions: this.generateCompareQuestions(),
                    answered: false
                };
                this.showCompareQuestion();
                this.updateProgress('compare-progress', 0);
            }

            generateCompareQuestions() {
                const questions = [];
                const objects = ['nebula', 'galaxy', 'star cluster', 'planet', 'cosmic dust'];
                
                for (let i = 0; i < 5; i++) {
                    const telescope = GAME_DATA.telescopes[Math.floor(Math.random() * GAME_DATA.telescopes.length)];
                    const object = objects[Math.floor(Math.random() * objects.length)];
                    questions.push({
                        telescope: telescope,
                        object: object,
                        correct: telescope.shortName
                    });
                }
                return questions;
            }

            showCompareQuestion() {
                const question = this.compareState.questions[this.compareState.currentQuestion];
                const canvas = document.getElementById('compare-canvas');
                
                if (canvas) {
                    this.drawTelescopeView(canvas.getContext('2d'), question.telescope, question.object);
                }

                document.getElementById('compare-question').textContent = 
                    `Which telescope captured this ${question.object}?`;

                // Reset button states
                document.querySelectorAll('.telescope-btn').forEach(btn => {
                    btn.classList.remove('correct', 'incorrect', 'selected');
                    btn.style.pointerEvents = 'auto';
                    btn.setAttribute('aria-checked', 'false');
                });

                document.getElementById('compare-feedback').classList.remove('show', 'correct', 'incorrect');
                this.compareState.answered = false;
            }

            drawTelescopeView(ctx, telescope, object) {
                const width = ctx.canvas.width;
                const height = ctx.canvas.height;
                
                // Clear canvas
                ctx.fillStyle = '#000011';
                ctx.fillRect(0, 0, width, height);

                // Add background stars
                for (let i = 0; i < 30; i++) {
                    ctx.fillStyle = '#ffffff';
                    ctx.beginPath();
                    ctx.arc(
                        Math.random() * width,
                        Math.random() * height,
                        Math.random() * 2,
                        0, 2 * Math.PI
                    );
                    ctx.fill();
                }

                // Draw main cosmic object with telescope-specific characteristics
                const detail = telescope.shortName === 'JWST' ? 1.5 :
                              telescope.shortName === 'Hubble' ? 1.2 : 1.0;

                const gradient = ctx.createRadialGradient(width/2, height/2, 0, width/2, height/2, 80 * detail);
                gradient.addColorStop(0, telescope.color);
                gradient.addColorStop(0.5, telescope.color + '80');
                gradient.addColorStop(1, telescope.color + '20');
                
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(width/2, height/2, 60 * detail, 0, 2 * Math.PI);
                ctx.fill();

                // Add telescope-specific visual effects
                if (telescope.shortName === 'JWST') {
                    // Add infrared-style diffraction spikes
                    ctx.strokeStyle = telescope.color;
                    ctx.lineWidth = 2;
                    for (let i = 0; i < 4; i++) {
                        ctx.beginPath();
                        ctx.moveTo(width/2 - 40, height/2);
                        ctx.lineTo(width/2 + 40, height/2);
                        ctx.moveTo(width/2, height/2 - 40);
                        ctx.lineTo(width/2, height/2 + 40);
                        ctx.stroke();
                    }
                }
            }

            answerCompareQuestion(selected) {
                if (this.compareState.answered) return;
                
                this.compareState.answered = true;
                const question = this.compareState.questions[this.compareState.currentQuestion];
                const correct = selected === question.correct;

                document.querySelectorAll('.telescope-btn').forEach(btn => {
                    btn.style.pointerEvents = 'none';
                    const telescope = btn.dataset.telescope;
                    
                    if (telescope === selected) {
                        btn.classList.add('selected');
                        btn.setAttribute('aria-checked', 'true');
                    }
                    if (telescope === question.correct) {
                        btn.classList.add('correct');
                    } else if (telescope === selected && !correct) {
                        btn.classList.add('incorrect');
                    }
                });

                const feedback = document.getElementById('compare-feedback');
                feedback.classList.add('show', correct ? 'correct' : 'incorrect');
                feedback.textContent = correct ? 
                    '✅ Correct! ' + question.telescope.features[0] :
                    '❌ Incorrect. The correct answer is ' + question.telescope.shortName;

                if (correct) {
                    this.compareState.score += this.getPointsForLevel();
                }

                this.trackEvent('comparison_answered', {
                    correct,
                    selected,
                    correctAnswer: question.correct
                });

                setTimeout(() => {
                    this.compareState.currentQuestion++;
                    if (this.compareState.currentQuestion < this.compareState.totalQuestions) {
                        this.showCompareQuestion();
                        this.updateProgress('compare-progress', 
                            (this.compareState.currentQuestion / this.compareState.totalQuestions) * 100);
                    } else {
                        this.finishCompareGame();
                    }
                }, 2500);
            }

            finishCompareGame() {
                this.gameScores.compare = this.compareState.score;
                this.totalScore += this.compareState.score;
                
                if (this.compareState.score >= this.getPointsForLevel() * 4) {
                    this.checkAchievement('telescope_expert');
                }
                
                this.trackEvent('comparison_completed', {score: this.compareState.score});
                this.showResults('compare');
            }

            // Gallery
            showGallery() {
                const grid = document.getElementById('gallery-grid');
                if (grid) {
                    grid.innerHTML = '';
                    GAME_DATA.cosmicObjects.forEach(obj => {
                        const item = document.createElement('div');
                        item.className = 'card';
                        item.innerHTML = `
                            <h3 style="color: var(--color-primary); margin-bottom: 10px;">${obj.name}</h3>
                            <div style="color: var(--color-secondary); font-size: 14px; margin-bottom: 5px;">${obj.type}</div>
                            <div style="color: var(--color-warning); font-size: 14px; margin-bottom: 15px;">Distance: ${obj.distance}</div>
                            <p>This cosmic wonder showcases the incredible capabilities of modern space telescopes in revealing the universe's hidden beauty.</p>
                        `;
                        grid.appendChild(item);
                    });
                }
            }

            // Results and Achievements
            showResults(gameMode) {
                this.switchScreen('results-screen');
                
                document.getElementById('final-score').textContent = this.totalScore;
                
                let accuracy = 0;
                switch(gameMode) {
                    case 'quiz':
                        accuracy = (this.quizState.score / (this.quizState.questions.length * this.getPointsForLevel())) * 100;
                        break;
                    case 'focus':
                        accuracy = Math.min(100, (this.focusState.score / (this.focusState.totalChallenges * this.getPointsForLevel())) * 100);
                        break;
                    case 'compare':
                        accuracy = (this.compareState.score / (this.compareState.totalQuestions * this.getPointsForLevel())) * 100;
                        break;
                }
                
                document.getElementById('accuracy').textContent = Math.round(accuracy) + '%';
                
                this.displayAchievements();
                this.saveScore();
                this.updateScoreDisplay();

                const facts = [
                    "The James Webb Space Telescope can see light that has traveled for over 13 billion years!",
                    "JWST's mirror is made of 18 hexagonal segments that work together as one giant mirror.",
                    "The telescope operates at extremely cold temperatures, around -370°F (-223°C).",
                    "The beryllium mirrors are coated with gold thinner than human hair!",
                    "JWST can detect the heat signature of a bumblebee on the Moon!",
                    "Each mirror segment can be adjusted with nanometer precision while in space.",
                    "The sunshield is about the size of a tennis court when fully deployed.",
                    "Our Materials Learning Session covers 30 chapters of space exploration knowledge!"
                ];
                
                document.getElementById('educational-fact').textContent = 
                    facts[Math.floor(Math.random() * facts.length)];

                this.trackEvent('game_completed', {
                    mode: gameMode,
                    score: this.totalScore,
                    accuracy
                });
            }

            checkAchievement(achievementId) {
                if (this.achievements.has(achievementId)) return;
                
                const achievement = GAME_DATA.achievements.find(a => a.id === achievementId);
                if (achievement) {
                    this.achievements.add(achievementId);
                    this.showAchievementModal(achievement);
                    this.saveAchievements();
                    this.trackEvent('achievement_unlocked', {achievement: achievementId});
                }
            }

            showAchievementModal(achievement) {
                document.getElementById('modal-achievement-icon').textContent = achievement.icon;
                document.getElementById('modal-achievement-name').textContent = achievement.name;
                document.getElementById('modal-achievement-desc').textContent = achievement.description;
                document.getElementById('achievement-modal').classList.remove('hidden');
                
                // Focus management for accessibility
                setTimeout(() => {
                    const modal = document.getElementById('achievement-modal');
                    const closeBtn = modal.querySelector('.btn');
                    if (closeBtn) closeBtn.focus();
                }, 100);
            }

            displayAchievements() {
                const container = document.getElementById('achievements-list');
                container.innerHTML = '';
                
                this.achievements.forEach(achievementId => {
                    const achievement = GAME_DATA.achievements.find(a => a.id === achievementId);
                    if (achievement) {
                        const badge = document.createElement('div');
                        badge.className = 'achievement-badge';
                        badge.innerHTML = `<span>${achievement.icon}</span> <span>${achievement.name}</span>`;
                        container.appendChild(badge);
                    }
                });
                
                if (this.achievements.size === 0) {
                    container.innerHTML = '<p>No achievements unlocked yet. Keep exploring!</p>';
                }
            }

            // Utility functions
            getPointsForLevel() {
                switch(this.currentLevel) {
                    case 'easy': return 10;
                    case 'medium': return 15;
                    case 'hard': return 25;
                    default: return 10;
                }
            }

            updateProgress(elementId, percentage) {
                const progressEl = document.getElementById(elementId);
                if (progressEl) {
                    progressEl.style.width = percentage + '%';
                }
            }

            updateScoreDisplay() {
                const elements = ['total-score', 'total-score-mode'];
                elements.forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.textContent = this.totalScore;
                });
            }

            // Save/Load functions with error handling
            saveScore() {
                try {
                    localStorage.setItem('jwst-game-score', this.totalScore.toString());
                } catch (error) {
                    console.warn('Could not save score:', error);
                }
            }

            loadScore() {
                try {
                    return parseInt(localStorage.getItem('jwst-game-score') || '0');
                } catch (error) {
                    console.warn('Could not load score:', error);
                    return 0;
                }
            }

            saveAchievements() {
                try {
                    localStorage.setItem('jwst-game-achievements', JSON.stringify(Array.from(this.achievements)));
                } catch (error) {
                    console.warn('Could not save achievements:', error);
                }
            }

            loadAchievements() {
                try {
                    return JSON.parse(localStorage.getItem('jwst-game-achievements') || '[]');
                } catch (error) {
                    console.warn('Could not load achievements:', error);
                    return [];
                }
            }

            // Analytics/tracking (placeholder - replace with your analytics service)
            trackEvent(eventName, properties = {}) {
                if (typeof gtag !== 'undefined') {
                    gtag('event', eventName, properties);
                }
                console.log('Event:', eventName, properties);
            }
        }

        // Global functions
        function switchScreen(screenId) {
            if (window.game) {
                window.game.switchScreen(screenId);
            }
        }

        function closeModal() {
            document.getElementById('achievement-modal').classList.add('hidden');
        }

        // Initialize game when page loads
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize game
            window.game = new JWSTGame();
            window.game.init();
            
            // Service Worker registration for offline capability
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js').catch(() => {
                    console.log('Service worker registration failed (optional)');
                });
            }
            
            // Performance monitoring
            if ('performance' in window && 'mark' in performance) {
                performance.mark('jwst-game-loaded');
            }
            
            console.log('🚀 JWST Educational Game loaded with Materials Integration!');
        });

        // Handle page visibility changes (pause/resume game)
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                console.log('Game paused');
            } else {
                console.log('Game resumed');
            }
        });

        // Handle offline/online status
        window.addEventListener('online', () => {
            console.log('Game is online');
        });

        window.addEventListener('offline', () => {
            console.log('Game is offline - core features still available');
        });
    </script>
</body>
</html>
